# 用Python来对B站封面进行获取开发日志(1) - BilibiliCover

​	很久之前写了一个工具用来获取b站的封面，我把它和Flask结合到一起了，构建了一个web项目，后来发现很不稳点，bug还有点多，排查了一下这个工具当前写出来没考虑太多，导致后来开发后台的时候，发现很难改，好多代码我都看不太动了，论注释的重要性，还有就是当前时，写的时候一把梭，没考虑太多。目前对这个工具模块进行重构，记录一下。

​	这个web页面在这里：https://bilibili.hecady.com/

​	开原地址：https://github.com/Smalltred/BilibiliCover

## 首先

B站的全站的链接基本上就分为以下几种：

|                       链接                        |     类型     |     番号      | 是否重定向 |
| :-----------------------------------------------: | :----------: | :-----------: | :--------: |
|   https://www.bilibili.com/video/BV1S24y1w7rU/    |  分P视频ID   | BV1S24y1w7rU  |     否     |
|   https://www.bilibili.com/video/BV1hL411m7B5/    |  单P视频ID   | BV1hL411m7B5/ |     否     |
|       https://www.bilibili.com/video/av1564       |  多P视频ID   |    av1564     |     否     |
|  https://www.bilibili.com/bangumi/play/ep743051   |  番剧视频ID  |   ep743051    |     否     |
|   https://www.bilibili.com/bangumi/play/ss26266   |  番剧视频ID  |    ss26266    |     否     |
| https://www.bilibili.com/bangumi/media/md28229233 |  番剧合集ID  |  md28229233   |     否     |
|    【xxx-哔哩哔哩国创】https://b23.tv/ep705756    | 番剧分享短链 |   ep705756    |     是     |
|      【xxx-哔哩哔哩】 https://b23.tv/hMwMJ70      | 视频分享短链 | BV1Kg4y1s73a  |     是     |

以上就是B站大部分链接的类型了。他们都有一个共同点www.bilibili.com和[b23.tv]()域名。

------



## 需求

​	你无法控制用户的输入的内容，我们在开发的时候，就做好异常处理，当出现错误的时候，我要提示，输入内容不正确，哪里不正确，同时也方便我们后期调试。

### 一、对输入的内容的判断

首先我们要对用户输入的内容进行匹配，我要提取用户输入的内容中是否包含链接

- [x] 是，如果包含则进行下一步的判断，匹配域名是否为www.bilibili.com和[b23.tv]()，如果是[b23.tv]()这个域名就直接使用[requests库](https://requests.readthedocs.io/projects/cn/zh_CN/latest/)进行重定向获取到真是地址。从`ur`l中匹配番号，如果没有匹配到就提示获取不到或者链接不正确。
- [ ] 否，对其内容进行再次匹配，不是链接有可能是直接的番号，直接从内容匹配番号，如果还是没有匹配到就提示请输入的内容。

**流程如下**

![1681431795968.jpg](https://img.hecady.com/i/2023/2023004014064389cf582a3f.jpg)
